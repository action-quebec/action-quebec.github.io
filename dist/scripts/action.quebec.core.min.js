(()=>{var m=Object.defineProperty;var g=(t,e,n)=>e in t?m(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var i=(t,e,n)=>g(t,typeof e!="symbol"?e+"":e,n);self.create=(t,e=null,n=null)=>{let a=document.createElement(t);return e&&(a.className=e),n&&(a.innerHTML=n),a};HTMLElement.prototype.create=function(t,e=null,n=null){let a=create(t,e,n);return this.append(a),a};self.loadJsonProperties=async function(t,e={}){let n=Object.entries(e),a=await Promise.allSettled(n.map(async([s,r])=>{let o=await fetch(r),l=null;try{l=await o.json()}catch{}return{key:s,url:r,status:o.status,ok:o.ok,data:l}}));for(let s of a)if(s.status==="fulfilled"){let{key:r,url:o,status:l,ok:h,data:u}=s.value;if(!h){console.error(`${r} [${l} - ERREUR] ${o}`);continue}t[r]=u}else console.error("Erreur r\xE9seau/JS pendant le chargement :",s.reason);return t};self.pad=t=>String(t).padStart(2,"0");self.fmtDate=t=>`${t.getFullYear()}-${pad(t.getMonth()+1)}-${pad(t.getDate())}`;self.isoLocal=t=>new Date(t).toISOString();self.addDays=(t,e)=>new Date(t.getFullYear(),t.getMonth(),t.getDate()+e);self.inTZ=(t,e="America/Toronto")=>new Date(t).toLocaleDateString("fr-CA",{timeZone:e});self.ymd=t=>new Date(t.getFullYear(),t.getMonth(),t.getDate()).toISOString().slice(0,10);self.startOfWeek=(t,e=0)=>{let n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=(n.getDay()-e+7)%7;return n.setDate(n.getDate()-a),n};window.LightSwitch={switch:null,init:function(){let t=localStorage.getItem("theme");t&&document.documentElement.setAttribute("data-theme",t),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>this.setTheme(e.matches?"dark":"light")),document.addEventListener("DOMContentLoaded",e=>document.body.create("div","lightswitch").addEventListener("click",n=>this.toogleTheme())),window.addEventListener("resize",e=>document.documentElement.style.setProperty("--vwpx",String(window.innerWidth)),{passive:!0}),document.documentElement.style.setProperty("--vwpx",String(window.innerWidth))},getTheme:function(){return getComputedStyle(document.documentElement).getPropertyValue("--theme").replace(/^['"]|['"]$/g,"").toLocaleLowerCase().trim()},setTheme:function(t){document.documentElement.setAttribute("data-theme",t),localStorage.setItem("theme",t)},toogleTheme:function(){this.setTheme(this.getTheme()==="dark"?"light":"dark")}};LightSwitch.init();var d=class{constructor(e,n={}){i(this,"MONTH_NAMES",["janvier","f\xE9vrier","mars","avril","mai","juin","juillet","ao\xFBt","septembre","octobre","novembre","d\xE9cembre"]);i(this,"WEEKDAY_NAMES",["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]);i(this,"parent",null);i(this,"container",null);i(this,"label",null);i(this,"month",null);i(this,"current",null);i(this,"events",null);i(this,"opts",{placeholder:!1,onRenderDate:!1});this.events=new Set,this.current=new Date,this.opts={...this.opts,...n},this.parent=document.querySelector(e),this.label=this.opts.placeholder?document.querySelector(this.opts.placeholder):null,this.container=this.parent.create("div","pxcalendar");let a=this.container.create("div","pxcalendar__daynames");this.WEEKDAY_NAMES.forEach(s=>a.create("div","pxcalendar__daynames__name",s)),this.month=this.container.create("div","pxcalendar__month"),this.render()}async render(){let e=new Date(this.current.getFullYear(),this.current.getMonth(),1),n=startOfWeek(e,0),a=[];for(let s=0;s<42;s++){let r=addDays(n,s),o=r.getMonth()!==this.current.getMonth(),l=ymd(r),h=l===ymd(new Date),u=this.events.has(l),c=create("div","pxcalendar__month__day",`<span>${r.getDate()}</span>`);o&&c.classList.add("outside"),u&&c.classList.add("has-event"),h&&c.classList.add("today"),u&&this.opts.onRenderDate&&this.opts.onRenderDate(l,c),a.push(c)}this.month.replaceChildren(...a),this.label&&(this.label.innerText=`${this.MONTH_NAMES[this.current.getMonth()]} ${this.current.getFullYear()}`)}async addEvents(e){this.events=new Set([...this.events,...e]),this.render()}async next(){this.current=new Date(this.current.getFullYear(),this.current.getMonth()+1,1),this.render()}async previous(){this.current=new Date(this.current.getFullYear(),this.current.getMonth()-1,1),this.render()}};var p="America/Toronto",f=6,w=12;window.Quebec={secrets:null,prec:null,suiv:null,title:null,calendar:null,events:null,unPays:async function(){await Promise.all([this.initCalendar(),loadJsonProperties(this,{secrets:"bt1oh97j7X.json"})]),this.loadGoogleCalendar()},initCalendar:async function(){this.calendar=new d(".calendrier__container",{placeholder:".calendrier__pagination__cour",onRenderDate:(t,e)=>this.renderEvent(t,e)}),document.querySelector(".calendrier__pagination__prec > span").addEventListener("click",t=>this.calendar.previous()),document.querySelector(".calendrier__pagination__suiv > span").addEventListener("click",t=>this.calendar.next()),this.title=document.querySelector(".calendrier__pagination__cour")},loadGoogleCalendar:async function(){this.events=await this.queryGoogleCalendar();let t=new Set(this.events.map(e=>{let n=new Date(e.start),a=new Date(n.getFullYear(),n.getMonth(),n.getDate());return ymd(a)}));this.calendar.addEvents(t)},queryGoogleCalendar:async function(){let{timeMin:t,timeMax:e}=this.getRangeBounds(),n=new URL(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(this.secrets.CALENDAR_ID)}/events`);n.searchParams.set("key",this.secrets.GOOGLE_API_KEY),n.searchParams.set("supportsAttachments","true"),n.searchParams.set("singleEvents","true"),n.searchParams.set("orderBy","startTime"),n.searchParams.set("timeMin",t),n.searchParams.set("timeMax",e),n.searchParams.set("timeZone",p);let a=await fetch(n.toString());if(!a.ok)throw new Error("Erreur API Google Calendar");let s=await a.json();return localStorage.setItem("lastItems",JSON.stringify(s.items??[])),this.mapGCalEvents(s.items??[])},getRangeBounds:function(){let t=new Date,e=new Date(t),n=new Date(t);return e.setMonth(e.getMonth()-f),n.setMonth(n.getMonth()+w),{timeMin:e.toISOString(),timeMax:n.toISOString()}},mapGCalEvents:function(t){return t.filter(e=>e.status!=="cancelled").map(e=>{let n=!!(e.start&&e.start.date),a=n?fmtDate(new Date(e.start.date)):isoLocal(e.start.dateTime||e.start),s=n?fmtDate(new Date(e.end.date)):isoLocal(e.end.dateTime||e.end),{html:r,firstImage:o}=this.replaceImageLinks(e.description||"");return{id:e.id,title:e.summary||"(Sans titre)",start:a,end:s,location:e.location||null,raw:{htmlLink:e.htmlLink},description:r,image:o}})},replaceImageLinks:function(t){let e=/<a\s+href="([^"]+\.(?:jpg|jpeg|png|webp|gif|svg))"[^>]*>.*?<\/a>/gi,n=null;return{html:t.replace(e,(s,r)=>(n||(n=r),`<img src="${r}">`)),firstImage:n}},getEventsByDate:function(t){return this.events.filter(e=>{let n=inTZ(e.start),a=inTZ(new Date(new Date(e.end)-1));return n<=t&&t<=a})},renderEvent:async function(t,e){let n=this.getEventsByDate(t),a=e.create("div","pxcalendar__month__day__bgimg");n[0].image&&a.style.setProperty("--image-1",`url(${n[0].image})`),n.length>1&&n[1].image&&a.style.setProperty("--image-2",`url(${n[1].image})`)}};})();
