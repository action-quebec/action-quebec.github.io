(()=>{var m=Object.defineProperty;var g=(e,t,n)=>t in e?m(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var o=(e,t,n)=>g(e,typeof t!="symbol"?t+"":t,n);self.create=(e,t=null,n=null)=>{let a=document.createElement(e);return t&&(a.className=t),n&&(a.innerHTML=n),a};HTMLElement.prototype.create=function(e,t=null,n=null){let a=create(e,t,n);return this.append(a),a};self.loadJsonProperties=async function(e,t={}){let n=Object.entries(t),a=await Promise.allSettled(n.map(async([s,r])=>{let c=await fetch(r),i=null;try{i=await c.json()}catch{}return{key:s,url:r,status:c.status,ok:c.ok,data:i}}));for(let s of a)if(s.status==="fulfilled"){let{key:r,url:c,status:i,ok:h,data:u}=s.value;if(!h){console.error(`${r} [${i} - ERREUR] ${c}`);continue}e[r]=u}else console.error("Erreur r\xE9seau/JS pendant le chargement :",s.reason);return e};self.pad=e=>String(e).padStart(2,"0");self.fmtDate=e=>`${e.getFullYear()}-${pad(e.getMonth()+1)}-${pad(e.getDate())}`;self.isoLocal=e=>new Date(e).toISOString();self.addDays=(e,t)=>new Date(e.getFullYear(),e.getMonth(),e.getDate()+t);self.inTZ=(e,t="America/Toronto")=>new Date(e).toLocaleDateString("fr-CA",{timeZone:t});self.ymd=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()).toISOString().slice(0,10);self.startOfWeek=(e,t=0)=>{let n=new Date(e.getFullYear(),e.getMonth(),e.getDate()),a=(n.getDay()-t+7)%7;return n.setDate(n.getDate()-a),n};window.LightSwitch={switch:null,init:function(){let e=localStorage.getItem("theme");e&&document.documentElement.setAttribute("data-theme",e),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>this.setTheme(t.matches?"dark":"light")),document.addEventListener("DOMContentLoaded",t=>document.body.create("div","lightswitch").addEventListener("click",n=>this.toogleTheme())),window.addEventListener("resize",t=>document.documentElement.style.setProperty("--vwpx",String(window.innerWidth)),{passive:!0}),document.documentElement.style.setProperty("--vwpx",String(window.innerWidth))},getTheme:function(){return getComputedStyle(document.documentElement).getPropertyValue("--theme").replace(/^['"]|['"]$/g,"").toLocaleLowerCase().trim()},setTheme:function(e){document.documentElement.setAttribute("data-theme",e),localStorage.setItem("theme",e)},toogleTheme:function(){this.setTheme(this.getTheme()==="dark"?"light":"dark")}};LightSwitch.init();var d=class{constructor(t,n={}){o(this,"MONTH_NAMES",["janvier","f\xE9vrier","mars","avril","mai","juin","juillet","ao\xFBt","septembre","octobre","novembre","d\xE9cembre"]);o(this,"WEEKDAY_NAMES",["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]);o(this,"parent",null);o(this,"container",null);o(this,"label",null);o(this,"month",null);o(this,"current",null);o(this,"events",null);o(this,"opts",{placeholder:!1,onRenderDate:!1});this.opts={...this.opts,...n},this.events=new Set,this.current=new Date,this.parent=document.querySelector(t),this.label=this.opts.placeholder?document.querySelector(this.opts.placeholder):null,this.container=this.parent.create("div","pxcalendar");let a=this.container.create("div","pxcalendar__daynames");this.WEEKDAY_NAMES.forEach(s=>a.create("div","pxcalendar__daynames__name",s)),this.month=this.container.create("div","pxcalendar__month"),this.render()}async render(){let t=new Date(this.current.getFullYear(),this.current.getMonth(),1),n=startOfWeek(t,0),a=[];for(let s=0;s<42;s++){let r=addDays(n,s),c=r.getMonth()!==this.current.getMonth(),i=ymd(r),h=i===ymd(new Date),u=this.events.has(i),l=create("div","pxcalendar__month__day",`<span>${r.getDate()}</span>`);c&&l.classList.add("outside"),u&&l.classList.add("has-event"),h&&l.classList.add("today"),u&&this.opts.onRenderDate&&this.opts.onRenderDate(i,l),a.push(l)}this.month.replaceChildren(...a),this.label&&(this.label.innerText=`${this.MONTH_NAMES[this.current.getMonth()]} ${this.current.getFullYear()}`)}async addEvents(t){this.events=new Set([...this.events,...t]),this.render()}async next(){this.current=new Date(this.current.getFullYear(),this.current.getMonth()+1,1),this.render()}async previous(){this.current=new Date(this.current.getFullYear(),this.current.getMonth()-1,1),this.render()}};var p="America/Toronto",f=6,w=12;window.Quebec={secrets:null,prec:null,suiv:null,title:null,calendar:null,events:null,unPays:async function(){await Promise.all([loadJsonProperties(this,{secrets:"/bt1oh97j7X.json"}),this.initCalendar()]),this.loadGoogleCalendar(),console.log("Qu\xE9bec un pays!")},initCalendar:async function(){this.calendar=new d(".calendrier__container",{placeholder:".calendrier__pagination__cour",onRenderDate:(e,t)=>this.renderEvent(e,t)}),document.querySelector(".calendrier__pagination__prec > span").addEventListener("click",e=>this.calendar.previous()),document.querySelector(".calendrier__pagination__suiv > span").addEventListener("click",e=>this.calendar.next()),this.title=document.querySelector(".calendrier__pagination__cour")},loadGoogleCalendar:async function(){this.events=await this.queryGoogleCalendar();let e=new Set(this.events.map(t=>{let n=new Date(t.start),a=new Date(n.getFullYear(),n.getMonth(),n.getDate());return ymd(a)}));this.calendar.addEvents(e)},queryGoogleCalendar:async function(){let e=localStorage.getItem("lastItems");if(e)return this.mapGCalEvents(JSON.parse(e));let{timeMin:t,timeMax:n}=this.getRangeBounds(),a=new URL(`https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(this.secrets.CALENDAR_ID)}/events`);a.searchParams.set("key",this.secrets.GOOGLE_API_KEY),a.searchParams.set("supportsAttachments","true"),a.searchParams.set("singleEvents","true"),a.searchParams.set("orderBy","startTime"),a.searchParams.set("timeMin",t),a.searchParams.set("timeMax",n),a.searchParams.set("timeZone",p);let s=await fetch(a.toString());if(!s.ok)throw new Error("Erreur API Google Calendar");let r=await s.json();return localStorage.setItem("lastItems",JSON.stringify(r.items??[])),this.mapGCalEvents(r.items??[])},getRangeBounds:function(){let e=new Date,t=new Date(e),n=new Date(e);return t.setMonth(t.getMonth()-f),n.setMonth(n.getMonth()+w),{timeMin:t.toISOString(),timeMax:n.toISOString()}},mapGCalEvents:function(e){return e.filter(t=>t.status!=="cancelled").map(t=>{let n=!!(t.start&&t.start.date),a=n?fmtDate(new Date(t.start.date)):isoLocal(t.start.dateTime||t.start),s=n?fmtDate(new Date(t.end.date)):isoLocal(t.end.dateTime||t.end);return{id:t.id,title:t.summary||"(Sans titre)",start:a,end:s,location:t.location||"",raw:{htmlLink:t.htmlLink},description:t.description||""}})},getEventsByDate:function(e){return this.events.filter(t=>{let n=inTZ(t.start),a=inTZ(new Date(new Date(t.end)-1));return n<=e&&e<=a})},renderEvent:async function(e,t){this.getEventsByDate(e).forEach(a=>{console.log(a)})}};})();
